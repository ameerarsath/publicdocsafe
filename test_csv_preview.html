<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Preview Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        h2 {
            color: #555;
            margin-bottom: 15px;
        }
        .test-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #csvPreview {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSV Preview Test</h1>

        <div class="section">
            <h2>Test CSV Plugin Directly</h2>
            <button class="test-button" onclick="testCSVPlugin()">Test CSV Plugin</button>
            <div id="pluginResult"></div>
        </div>

        <div class="section">
            <h2>Test File Upload</h2>
            <input type="file" id="csvFile" accept=".csv" onchange="handleFileSelect(event)">
            <div id="fileResult"></div>
            <div id="csvPreview"></div>
        </div>

        <div class="section">
            <h2>Test External Share Simulation</h2>
            <button class="test-button" onclick="simulateExternalShare()">Simulate External Share</button>
            <div id="externalResult"></div>
        </div>
    </div>

    <script>
        // Simple CSV parser for testing
        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',');
            const rows = lines.slice(1).map(line => line.split(','));
            return { headers, rows };
        }

        // Generate simple HTML table from CSV data
        function generateCSVTable(csvData, fileName) {
            const { headers, rows } = csvData;

            let html = `
                <div class="csv-preview-container">
                    <style>
                        .csv-preview-container {
                            width: 100%;
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        }
                        .csv-header {
                            background: #28a745;
                            color: white;
                            padding: 1rem;
                            margin-bottom: 1rem;
                        }
                        .csv-table {
                            width: 100%;
                            border-collapse: collapse;
                            font-size: 0.9rem;
                        }
                        .csv-table th {
                            background: #f8f9fa;
                            border: 1px solid #dee2e6;
                            padding: 0.75rem;
                            text-align: left;
                            font-weight: 600;
                        }
                        .csv-table td {
                            border: 1px solid #dee2e6;
                            padding: 0.75rem;
                        }
                        .csv-table tr:nth-child(even) {
                            background: #f8f9fa;
                        }
                    </style>

                    <div class="csv-header">
                        <h3>${fileName}</h3>
                        <p>CSV Data File â€¢ ${rows.length} rows</p>
                    </div>

                    <table class="csv-table">
                        <thead>
                            <tr>
                                ${headers.map(h => `<th>${h.trim()}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${rows.map(row =>
                                `<tr>${row.map(cell => `<td>${cell.trim()}</td>`).join('')}</tr>`
                            ).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            return html;
        }

        function testCSVPlugin() {
            const resultDiv = document.getElementById('pluginResult');

            // Create test CSV data
            const csvData = `Name,Age,City
John,30,New York
Jane,25,Los Angeles
Bob,35,Chicago`;

            try {
                const parsed = parseCSV(csvData);
                const html = generateCSVTable(parsed, 'test.csv');

                resultDiv.innerHTML = `
                    <div class="result success">
                        CSV parsing successful! Generated preview below:
                    </div>
                    ${html}
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            const resultDiv = document.getElementById('fileResult');
            const previewDiv = document.getElementById('csvPreview');

            if (!file) return;

            if (!file.name.toLowerCase().endsWith('.csv')) {
                resultDiv.innerHTML = '<div class="result error">Please select a CSV file</div>';
                return;
            }

            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const text = e.target.result;
                    const parsed = parseCSV(text);
                    const html = generateCSVTable(parsed, file.name);

                    resultDiv.innerHTML = '<div class="result success">File loaded successfully!</div>';
                    previewDiv.innerHTML = html;
                } catch (error) {
                    resultDiv.innerHTML = `<div class="result error">Error reading file: ${error.message}</div>`;
                    previewDiv.innerHTML = '';
                }
            };

            reader.onerror = function() {
                resultDiv.innerHTML = '<div class="result error">Error reading file</div>';
            };

            reader.readAsText(file);
        }

        function simulateExternalShare() {
            const resultDiv = document.getElementById('externalResult');

            // Simulate the CSV preview component behavior
            const mockShareToken = 'test-token-123';
            const mockFileName = 'sample.csv';
            const mockMimeType = 'text/csv';

            // Simulate CSV data fetch
            const csvData = `Product,Price,Quantity,Category
Laptop,999.99,10,Electronics
Mouse,25.50,50,Electronics
Keyboard,75.00,30,Electronics
Monitor,299.99,15,Electronics
Desk,199.00,5,Furniture
Chair,149.99,8,Furniture`;

            try {
                const parsed = parseCSV(csvData);
                const html = generateCSVTable(parsed, mockFileName);

                resultDiv.innerHTML = `
                    <div class="result success">
                        External share simulation successful!
                        <br>Share Token: ${mockShareToken}
                        <br>File: ${mockFileName}
                        <br>Type: ${mockMimeType}
                    </div>
                    <div style="margin-top: 20px;">
                        ${html}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        Simulation error: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>